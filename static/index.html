<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Tracking Demo</title>
</head>
<body>
<h3>Tracking Demo</h3>

<p>Đang thu thập fingerprint và gửi đến server...</p>

<script>
function canvasFP() {
    const c = document.createElement("canvas");
    const ctx = c.getContext("2d");
    ctx.textBaseline = "top";
    ctx.font = "16px Arial";
    ctx.fillText("fingerprint", 2, 2);
    return c.toDataURL();
}

function webglFP() {
    const c = document.createElement("canvas");
    const gl = c.getContext("webgl");
    if (!gl) return "no-webgl";
    return {
        vendor: gl.getParameter(gl.VENDOR),
        renderer: gl.getParameter(gl.RENDERER)
    };
}

// Thu thập dữ liệu fingerprint
const data = {
    userAgent: navigator.userAgent,
    platform: navigator.platform,
    vendor: navigator.vendor,
    languages: navigator.languages,
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    timezoneOffset: new Date().getTimezoneOffset(),

    screen: {
        width: screen.width,
        height: screen.height,
        availWidth: screen.availWidth,
        availHeight: screen.availHeight,
        colorDepth: screen.colorDepth,
        pixelRatio: window.devicePixelRatio
    },

    hardware: {
        cores: navigator.hardwareConcurrency,
        memory: navigator.deviceMemory || "unknown",
        touchSupport: navigator.maxTouchPoints
    },

    storage: {
        cookies: navigator.cookieEnabled,
        localStorage: !!window.localStorage,
        sessionStorage: !!window.sessionStorage
    },

    privacy: {
        doNotTrack: navigator.doNotTrack
    },

    network: {
        online: navigator.onLine
    },

    fingerprint: {
        canvas: canvasFP(),
        webgl: webglFP()
    },

    // Thêm timestamp để dễ theo dõi
    timestamp: new Date().toISOString()
};

// Debug ở browser console trước khi gửi
console.log("Data to be sent:", data);

fetch("/collect", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
})
.then(response => {
    if (!response.ok) {
        throw new Error(`Server error: ${response.status}`);
    }
    console.log("Tracking data sent successfully!");
    return response.json();
})
.catch(error => {
    console.error("Error sending tracking data:", error);
    // Optional: gửi fallback hoặc retry nếu cần
});
</script>

</body>
</html>
